{
	"info": {
		"_postman_id": "9cac41a5-3f22-4db9-90d8-c143caa1aedf",
		"name": "API-03 Change Password Test Cases",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "47838002",
		"_collection_link": "https://l-tr-n-kim-oanh-s-team-219428.postman.co/workspace/Team-Workspace~f4a8c71b-9cd4-4302-873d-2fdba87ec6ae/collection/47838002-9cac41a5-3f22-4db9-90d8-c143caa1aedf?action=share&source=collection_link&creator=47838002"
	},
	"item": [
		{
			"name": "TC01 - Happy Path",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"function safeJson(){ try { return pm.response.json(); } catch(e){ return null; } }",
							"function getNewPwd(){ try { return JSON.parse(pm.request.body.raw).new_password; } catch(e){ return null; } }",
							"",
							"pm.test('Status 200', function(){ pm.response.to.have.status(200); });",
							"var j = safeJson();",
							"pm.test('success === true', function(){ pm.expect(j && j.success).to.eql(true); });",
							"",
							"var ok = pm.response.code === 200 && j && j.success === true;",
							"if (!ok) { return; }",
							"",
							"// === Teardown: reset về baseline ===",
							"var baseUrl    = pm.variables.get('baseUrl');",
							"var oldToken   = pm.variables.get('token');",
							"var baseline   = pm.environment.get('baseline_password');",
							"var newPwd     = getNewPwd();",
							"var loginEmail = pm.environment.get('login_email');",
							"",
							"function findToken(obj){",
							"  if (!obj || typeof obj !== 'object') return null;",
							"  if (typeof obj.token === 'string') return obj.token;",
							"  if (typeof obj.access_token === 'string') return obj.access_token;",
							"  if (obj.authorization && typeof obj.authorization.token === 'string') return obj.authorization.token;",
							"  if (obj.data){",
							"    var t = findToken(obj.data); if (t) return t;",
							"    if (typeof obj.data.access_token === 'string') return obj.data.access_token;",
							"    if (typeof obj.data.token === 'string') return obj.data.token;",
							"  }",
							"  for (var k in obj){",
							"    if (!Object.prototype.hasOwnProperty.call(obj,k)) continue;",
							"    var v = obj[k];",
							"    if (typeof v === 'string' && /(^|_)token$|^jwt$|^id_token$/.test(k)) return v;",
							"    if (v && typeof v === 'object'){ var r = findToken(v); if (r) return r; }",
							"  }",
							"  return null;",
							"}",
							"",
							"function resetWith(tokenToUse){",
							"  pm.sendRequest({",
							"    url: baseUrl + '/users/change-password',",
							"    method: 'POST',",
							"    header: { Authorization: 'Bearer ' + tokenToUse, 'Content-Type': 'application/json' },",
							"    body: { mode: 'raw', raw: JSON.stringify({",
							"      current_password: newPwd,",
							"      new_password: baseline,",
							"      new_password_confirmation: baseline",
							"    }) }",
							"  }, function (err, res) {",
							"    if (res && (res.code === 200 || res.code === 204)) {",
							"      pm.test('Reset back to baseline', function(){ pm.expect([200,204]).to.include(res.code); });",
							"      return;",
							"    }",
							"    pm.sendRequest({",
							"      url: baseUrl + '/users/login',",
							"      method: 'POST',",
							"      header: { 'Content-Type': 'application/json', 'Accept': 'application/json' },",
							"      body: { mode: 'raw', raw: JSON.stringify({ email: loginEmail, password: newPwd }) }",
							"    }, function (e2, r2) {",
							"      var lj = null; try { lj = r2 && r2.json ? r2.json() : null; } catch(e){}",
							"      var freshToken = findToken(lj);",
							"      if (!freshToken) {",
							"        console.log('Re-login response code:', r2 && r2.code, 'body:', lj);",
							"        pm.test('Re-login skipped (no token in response)', function(){ pm.expect(true).to.eql(true); });",
							"        return;",
							"      }",
							"      pm.sendRequest({",
							"        url: baseUrl + '/users/change-password',",
							"        method: 'POST',",
							"        header: { Authorization: 'Bearer ' + freshToken, 'Content-Type': 'application/json' },",
							"        body: { mode: 'raw', raw: JSON.stringify({",
							"          current_password: newPwd,",
							"          new_password: baseline,",
							"          new_password_confirmation: baseline",
							"        }) }",
							"      }, function (e3, r3) {",
							"        pm.test('Reset back to baseline', function(){ pm.expect([200,204]).to.include(r3 && r3.code); });",
							"      });",
							"    });",
							"  });",
							"}",
							"",
							"if (newPwd && newPwd !== baseline) {",
							"  resetWith(oldToken);",
							"}"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{Welcome02!}}\",\"new_password\":\"welcome01\",\"new_password_confirmation\":\"welcome01!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC02 - Min Length Password (8 chars)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Abcde123\",\"new_password_confirmation\":\"Abcde123\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC03 - Password Too Short (7 chars)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Abcd123\",\"new_password_confirmation\":\"Abcd123\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC04 - Max Length Password (64 chars)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"new_password_confirmation\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC05 - Password Exceeds Max Length (65 chars)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"new_password_confirmation\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC06 - Password and Confirmation Mismatch",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Aa123456!\",\"new_password_confirmation\":\"aa123456!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC07 - Missing current_password",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC08 - Missing new_password",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC09 - Missing new_password_confirmation",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC10 - Incorrect current_password",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"wrong\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC11 - new_password identical to current_password (reject)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"welcome01\",\"new_password_confirmation\":\"welcome01\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC12 - Leading/trailing whitespaces in new_password",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 200 or 400 (trim policy)', ()=> pm.expect([200,400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"  Welcome02!  \",\"new_password_confirmation\":\"  Welcome02!  \"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC13 - Unicode characters in new_password",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Unicode allowed per policy (200/400/422)', ()=> pm.expect([200,400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Mậtkhẩu123!\",\"new_password_confirmation\":\"Mậtkhẩu123!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC14 - Alphanumeric-only new_password (likely reject by policy)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 200/400/422 (policy-dependent)', ()=> pm.expect([200,400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Abcdef12\",\"new_password_confirmation\":\"Abcdef12\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC15 - Special-characters-only new_password (likely reject)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422/200 (policy-dependent)', ()=> pm.expect([400,422,200]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"!@#$%^&*()\",\"new_password_confirmation\":\"!@#$%^&*()\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC16 - Extra unexpected field in body (should ignore)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 200 or 400 (ignore/validate)', ()=> pm.expect([200,400]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\",\"note\":\"abc\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC17 - Accept header text/plain (not supported -> 406)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400 (or 200 if server ignores Accept)', ()=> pm.expect([400,200]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "text/plain"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC18 - Missing Authorization header (401)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400', ()=> pm.expect(pm.response.code).to.eql(400));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC19 - Invalid/expired token (401)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400', ()=> pm.expect(pm.response.code).to.eql(400));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer invalid"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC20 - Missing Content-Type header (415/400)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 415/400', ()=> pm.expect([415,400]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC21 - Wrong Content-Type (text/plain -> 415)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400', ()=> pm.expect(pm.response.code).to.eql(400));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "text/plain"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC22 - Accept header application/xml (not supported -> 406)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400 (or 200 if server ignores Accept)', ()=> pm.expect([400,200]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "application/xml"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC23 - Malformed JSON in body (400)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400', ()=> pm.expect(pm.response.code).to.eql(400));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"a\""
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC24 - SQL injection in current_password (reject)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (no 5xx)', ()=> { pm.expect([400,422]).to.include(pm.response.code); });"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"abc' OR '1'='1\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC25 - XSS attempt in new_password (reject)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"<script>alert(1)</script>\",\"new_password_confirmation\":\"<script>alert(1)</script>\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC26 - Null byte injection in new_password",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 200/400/422 (policy-dependent)', ()=> pm.expect([200,400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"Pass\\u0000word123!\",\"new_password_confirmation\":\"Pass\\u0000word123!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC27 - Content-Type and body mismatch (-> 400/415)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/415 (not 200)', ()=> { pm.expect([400,415]).to.include(pm.response.code); pm.expect(pm.response.code).to.not.eql(200); });"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "message=hi"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC28 - Excessively long password (300 chars -> 400/413)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/413', ()=> pm.expect([400,413]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"new_password_confirmation\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC29 - Rate limiting/lockout after repeated invalid attempts",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const baseUrl = pm.variables.get('baseUrl');",
							"const token = pm.variables.get('token');",
							"const attempts = 6;",
							"let done = 0, locked = false;",
							"for (let i=0;i<attempts;i++){",
							"  pm.sendRequest({",
							"    url: baseUrl + '/users/change-password',",
							"    method: 'POST',",
							"    header: { Authorization: 'Bearer ' + token, 'Content-Type': 'application/json' },",
							"    body: { mode:'raw', raw: JSON.stringify({ current_password:'wrong', new_password:'Welcome02!', new_password_confirmation:'Welcome02!' }) }",
							"  }, (err,res)=>{",
							"    done++;",
							"    if ([429,401,403].includes(res && res.code)) locked = true;",
							"    if (done===attempts){ pm.test('Lockout / rate limit engaged', ()=> pm.expect(locked).to.eql(true)); }",
							"  });",
							"}"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"wrong\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC30 - All fields empty",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (all fields required)', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"\",\"new_password\":\"\",\"new_password_confirmation\":\"\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC31 - Case sensitivity mismatch (new_password vs confirmation)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (mismatch)', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"welcome02!\",\"new_password_confirmation\":\"WELCOME02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC32 - New password identical to current (reuse not allowed)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (password reuse forbidden)', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}\",\"new_password\":\"{{baseline_password}}\",\"new_password_confirmation\":\"{{baseline_password}}\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC33 - SQLi tautology in current_password (' OR 1=1 --)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (reject SQLi tautology)', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"' OR 1=1 --\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC34 - SQLi UNION-based in current_password",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (reject UNION injection)', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"' UNION SELECT null, null, null --\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC35 - SQLi stacked queries in current_password ('; DROP ...)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (reject stacked queries)', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"'; DROP TABLE users; --\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		},
		{
			"name": "TC36 - SQLi comment injection in current_password (/* ... */)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('Status 400/422 (reject comment injection)', ()=> pm.expect([400,422]).to.include(pm.response.code));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"current_password\":\"{{baseline_password}}'/*test*/\",\"new_password\":\"Welcome02!\",\"new_password_confirmation\":\"Welcome02!\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"change-password"
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.test('No 5xx', () => pm.expect(pm.response.code).to.not.be.within(500,599));"
				]
			}
		}
	]
}
